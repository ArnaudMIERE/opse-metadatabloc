{"remainingRequest":"/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/node_modules/babel-loader/lib/index.js!/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/src/lib/modules/opse-year-based-download-block/opse-year-based-download-block.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/src/lib/modules/opse-year-based-download-block/opse-year-based-download-block.vue","mtime":1646908488505},{"path":"/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/babel.config.js","mtime":1644331050195},{"path":"/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/openopse/Documents/GitHub/Catalogue Sedoo/projets/opse-metadatabloc/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgYXBwbHlQcmltYXJ5QW5kU2Vjb25kYXJ5Q29sb3JzIH0gZnJvbSAiLi4vLi4vdXRpbHMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIm9wc2UteWVhci1iYXNlZC1kb3dubG9hZC1ibG9jayIsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGRhdGFQb2xpY3k6IGZhbHNlLAogICAgICB5ZWFyczogW10sCiAgICAgIHBhcmFtczogW10sCiAgICAgIHNlbGVjdGVkWWVhcnM6IFtdLAogICAgICBzZWxlY3RlZFBhcmFtczogW10sCiAgICAgIGN1cnJlbnRTdGF0dXM6ICJQUkVQQVJJTkdfUkVRVUVTVCIsCiAgICAgIHVybDogbnVsbCwKICAgICAgZm9sZGVyRmlsZTogIi9kYXRhL25ldGNkZiIKICAgIH07CiAgfSwKICBwcm9wczogewogICAgbGFuZ3VhZ2U6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiZW4iCiAgICB9LAogICAgdGhlbWU6IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcHJpbWFyeUNvbG9yOiAiI0YzOUMxMiIsCiAgICAgICAgICBzZWNvbmRhcnlDb2xvcjogIiNBQUEiCiAgICAgICAgfTsKICAgICAgfQogICAgfSwKICAgIG1ldGFkYXRhOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogZnVuY3Rpb24gX2RlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgYXBwbHlUaGVtZTogZnVuY3Rpb24gYXBwbHlUaGVtZSgpIHsKICAgICAgcmV0dXJuIGFwcGx5UHJpbWFyeUFuZFNlY29uZGFyeUNvbG9ycyh0aGlzLnRoZW1lKTsKICAgIH0sCiAgICBpc1Zpc2libGU6IGZ1bmN0aW9uIGlzVmlzaWJsZSgpIHsKICAgICAgdmFyIGlzVmlzaWJsZSA9IGZhbHNlOwoKICAgICAgaWYgKHRoaXMudXJsICE9IG51bGwpIHsKICAgICAgICBpc1Zpc2libGUgPSB0cnVlOwogICAgICB9CgogICAgICB0aGlzLiRlbWl0KCJnZXRWaXNpYmlsaXR5IiwgewogICAgICAgIG5hbWU6IHRoaXMuJG9wdGlvbnMubmFtZSwKICAgICAgICBwcm9ncmFtbWF0aWNTY3JvbGxpbmdUaXRsZTogdGhpcy4kdCgib3BzZURvd25sb2FkIiksCiAgICAgICAgaXNWaXNpYmxlOiBpc1Zpc2libGUKICAgICAgfSk7CiAgICAgIHJldHVybiBpc1Zpc2libGU7CiAgICB9LAogICAgZG93bmxvYWRBbGxvd2VkOiBmdW5jdGlvbiBkb3dubG9hZEFsbG93ZWQoKSB7CiAgICAgIGlmICh0aGlzLnllYXJzICYmIHRoaXMueWVhcnMubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgbWV0YWRhdGE6IGZ1bmN0aW9uIG1ldGFkYXRhKCkgewogICAgICB0aGlzLmxvYWRZZWFycygpOwogICAgfSwKICAgIGxhbmd1YWdlOiBmdW5jdGlvbiBsYW5ndWFnZSh2YWx1ZSkgewogICAgICB0aGlzLiRpMThuLmxvY2FsZSA9IHZhbHVlOwogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHRoaXMuJGkxOG4ubG9jYWxlID0gdGhpcy5sYW5ndWFnZTsgLy90aGlzLmxvYWRZZWFycygpCgogICAgdGhpcy5maWxlKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBmaWxlOiBmdW5jdGlvbiBmaWxlKCkgewogICAgICB0aGlzLmxvYWRZZWFycyh0aGlzLmZvbGRlckZpbGUpOwogICAgfSwKICAgIGxvYWRQYXJhbXNOYW1lOiBmdW5jdGlvbiBsb2FkUGFyYW1zTmFtZShzaG9ydF9uYW1lKSB7CiAgICAgIGlmICh0aGlzLm1ldGFkYXRhLnBhcmFtZXRlclNldCA9PSBudWxsKSByZXR1cm4gIiI7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWV0YWRhdGEucGFyYW1ldGVyU2V0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMubWV0YWRhdGEucGFyYW1ldGVyU2V0W2ldLnNob3J0TmFtZSA9PSBzaG9ydF9uYW1lKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tZXRhZGF0YS5wYXJhbWV0ZXJTZXRbaV0ubG9uZ05hbWU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gIiI7CiAgICB9LAogICAgZG93bmxvYWQ6IGZ1bmN0aW9uIGRvd25sb2FkKHVybCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdGhpcy5jdXJyZW50U3RhdHVzID0gIlBSRVBBUklOR19SRVFVRVNUIjsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB0aGlzLmRvd25sb2FkRGlhbG9nID0gdHJ1ZTsKICAgICAgdGhpcy5heGlvcyh7CiAgICAgICAgbWV0aG9kOiAiZ2V0IiwKICAgICAgICB1cmw6IHVybAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIHNlbGYucmVxdWVzdElkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAvKnNlbGYuY2hlY2tlciA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgIHNlbGYuY2hlY2tEb3dubG9hZChzZWxmLm1ldGFkYXRhLmlkLHNlbGYucmVxdWVzdElkKTsKICAgICAgICAgfSwgNTAwMCk7Ki8KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgLy8gZGVidWdnZXIKICAgICAgICAvL3NlbGYuY2xlYXJDaGVja2VyKCk7CiAgICAgICAgc2VsZi5kaXNwbGF5RXJyb3IoIkFuIGVycm9yIGhhcyBvY2N1cmVkOiIgKyBlcnJvcik7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGRvd25sb2FkQWxsOiBmdW5jdGlvbiBkb3dubG9hZEFsbChpbmRleCkgewogICAgICAvL3RoaXMuZG93bmxvYWQodGhpcy51cmwrImRvd25sb2FkP2NvbGxlY3Rpb25JZD0iK3RoaXMubWV0YWRhdGEuaWQpCiAgICAgIHdpbmRvdy5vcGVuKHRoaXMudXJsICsgImRhdGEvdjFfMC9kb3dubG9hZD9jb2xsZWN0aW9uSWQ9IiArIHRoaXMubWV0YWRhdGEuaWQgKyAiJmZvbGRlcj0iICsgaW5kZXgpOwogICAgfSwKICAgIGRvd25sb2FkU2VsZWN0ZWQ6IGZ1bmN0aW9uIGRvd25sb2FkU2VsZWN0ZWQoaW5kZXgpIHsKICAgICAgd2luZG93Lm9wZW4odGhpcy51cmwgKyAiZGF0YS92MV8wL2Rvd25sb2FkWWVhcj9jb2xsZWN0aW9uSWQ9IiArIHRoaXMubWV0YWRhdGEuaWQgKyAiJmZvbGRlcj0iICsgaW5kZXggKyAiJmZpbHRlcj15ZWFyX19fIiArIHRoaXMuc2VsZWN0ZWRZZWFycy5qb2luKCJfX18iKSArICJfX19fcGFyYW1ldGVyX19fIiArIHRoaXMuc2VsZWN0ZWRQYXJhbXMuam9pbigiX19fIikpOwogICAgfSwKICAgIGxvYWRZZWFyczogZnVuY3Rpb24gbG9hZFllYXJzKGluZGV4KSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIHVybCA9IG51bGw7CgogICAgICBpZiAodGhpcy5tZXRhZGF0YSAmJiB0aGlzLm1ldGFkYXRhLmxpbmtzICYmIHRoaXMubWV0YWRhdGEubGlua3MubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tZXRhZGF0YS5saW5rcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHRoaXMubWV0YWRhdGEubGlua3NbaV0udHlwZSA9PSAiT1BFTlNFQVJDSF9MSU5LIikgewogICAgICAgICAgICB1cmwgPSB0aGlzLm1ldGFkYXRhLmxpbmtzW2ldLnVybDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnVybCA9IHVybDsKCiAgICAgIGlmICh1cmwgPT0gbnVsbCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgY29uc29sZS5sb2coInVybCAiLCB0aGlzLnVybCArICJkYXRhL3YxXzAvcmVxdWVzdDE/Y29sbGVjdGlvbj0iICsgdGhpcy5tZXRhZGF0YS5pZCArICImZm9sZGVyPSIgKyBpbmRleCk7CiAgICAgIHRoaXMuYXhpb3MoewogICAgICAgIG1ldGhvZDogImdldCIsCiAgICAgICAgdXJsOiB0aGlzLnVybCArICJkYXRhL3YxXzAvcmVxdWVzdDE/Y29sbGVjdGlvbj0iICsgdGhpcy5tZXRhZGF0YS5pZCArICImZm9sZGVyPSIgKyBpbmRleCAvL3VybDogdGhpcy51cmwgKyAiL3JlcXVlc3Q/Y29sbGVjdGlvbj0iK3RoaXMubWV0YWRhdGEuaWQsCgogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMi55ZWFycyA9IFtdOwogICAgICAgIF90aGlzMi5wYXJhbXMgPSBbXTsKICAgICAgICBfdGhpczIuc2VsZWN0ZWRQYXJhbXMgPSBbXTsKICAgICAgICBjb25zb2xlLmxvZygiUmVzcG9uc2UiLCByZXNwb25zZS5kYXRhKTsKCiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IHJlc3BvbnNlLmRhdGEuZW50cmllcy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgIF90aGlzMi55ZWFycy5wdXNoKHJlc3BvbnNlLmRhdGEuZW50cmllc1tfaV0uZGF0ZS5zdWJzdHJpbmcoMCwgNCkpOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgcmVzcG9uc2UuZGF0YS5waXZvdHMubGVuZ3RoOyBfaTIrKykgewogICAgICAgICAgX3RoaXMyLnNlbGVjdGVkUGFyYW1zLnB1c2gocmVzcG9uc2UuZGF0YS5waXZvdHNbX2kyXS5uYW1lKTsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IHJlc3BvbnNlLmRhdGEucGFyYW1ldGVycy5sZW5ndGg7IF9pMysrKSB7CiAgICAgICAgICBpZiAoIV90aGlzMi5zZWxlY3RlZFBhcmFtcy5pbmNsdWRlcyhyZXNwb25zZS5kYXRhLnBhcmFtZXRlcnNbX2kzXS5uYW1lKSkgewogICAgICAgICAgICBfdGhpczIucGFyYW1zLnB1c2gocmVzcG9uc2UuZGF0YS5wYXJhbWV0ZXJzW19pM10ubmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAvLyB0aGlzLmRpc3BsYXlFcnJvcigiQW4gZXJyb3IgaGFzIG9jY3VyZWQ6IiArIGVycm9yKQogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkJA;AACA;AACAA,wCADA;AAGAC,MAHA,kBAGA;AACA;AACAC,uBADA;AAEAC,eAFA;AAGAC,gBAHA;AAIAC,uBAJA;AAKAC,wBALA;AAMAC,wCANA;AAOAC,eAPA;AAQAC;AARA;AAUA,GAdA;AAgBAC;AACAC;AACAC,kBADA;AAEAC;AAFA,KADA;AAKAC;AACAF,kBADA;AAEAC;AACA;AACAE,iCADA;AAEAC;AAFA;AAIA;AAPA,KALA;AAeAC;AACAL,kBADA;AAEAC;AACA;AACA;AAJA;AAfA,GAhBA;AAuCAK;AACAC,cADA,wBACA;AACA;AACA,KAHA;AAKAC,aALA,uBAKA;AACA;;AACA;AACAA;AACA;;AAEA;AACApB,gCADA;AAEAqB,2DAFA;AAGAD;AAHA;AAKA;AACA,KAjBA;AAmBAE,mBAnBA,6BAmBA;AACA;AACA;AACA;;AACA;AACA;AAxBA,GAvCA;AAkEAC;AACAN,YADA,sBACA;AACA;AACA,KAHA;AAIAN,YAJA,oBAIAa,KAJA,EAIA;AACA;AACA;AANA,GAlEA;AA2EAC,SA3EA,qBA2EA;AACA,sCADA,CAEA;;AACA;AACA,GA/EA;AAiFAC;AACAC,QADA,kBACA;AACA;AACA,KAHA;AAKAC,kBALA,0BAKAC,UALA,EAKA;AACA;;AACA;AACA;AACA;AACA;AACA;;AACA;AACA,KAbA;AAeAC,YAfA,oBAeAtB,GAfA,EAeA;AAAA;;AACA;AACA;AACA;AACA;AACAuB,qBADA;AAEAvB;AAFA,SAIAwB,IAJA,CAIA;AACAC;AACA;AACA;AACA;AACA,OATA,EAUAC,KAVA,CAUA;AACA;AACA;AACAD;AACAE;AACA,OAfA,EAgBAC,OAhBA,CAgBA;AACA;AACA,OAlBA;AAmBA,KAtCA;AAwCAC,eAxCA,uBAwCAC,KAxCA,EAwCA;AACA;AACAC,kBACA,WACA,kCADA,GAEA,gBAFA,GAGA,UAHA,GAIAD,KALA;AAOA,KAjDA;AAmDAE,oBAnDA,4BAmDAF,KAnDA,EAmDA;AACAC,kBACA,WACA,sCADA,GAEA,gBAFA,GAGA,UAHA,GAIAD,KAJA,GAKA,iBALA,GAMA,8BANA,GAOA,kBAPA,GAQA,+BATA;AAWA,KA/DA;AAiEAG,aAjEA,qBAiEAH,KAjEA,EAiEA;AAAA;;AACA;;AACA,UACA,iBACA,mBADA,IAEA,8BAHA,EAIA;AACA;AACA;AACA9B;AACA;AACA;AACA;AACA;;AACA;;AACA;AACA;AACA;;AAEA;AACA2B,kBACA,MADA,EAEA,WACA,gCADA,GAEA,gBAFA,GAGA,UAHA,GAIAG,KANA;AAQA;AACAP,qBADA;AAEAvB,aACA,WACA,gCADA,GAEA,gBAFA,GAGA,UAHA,GAIA8B,KAPA,CAQA;;AARA,SAUAN,IAVA,CAUA;AACA;AACA;AACA;AACAG;;AAEA;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA,cACA,mEADA,EAEA;AACA;AACA;AACA;AACA,OA7BA,EA8BAD,KA9BA,CA8BA;AACA;AACAC;AACA,OAjCA,EAkCAC,OAlCA,CAkCA;AACA;AACA,OApCA;AAqCA;AAlIA;AAjFA","names":["name","data","dataPolicy","years","params","selectedYears","selectedParams","currentStatus","url","folderFile","props","language","type","default","theme","primaryColor","secondaryColor","metadata","computed","applyTheme","isVisible","programmaticScrollingTitle","downloadAllowed","watch","value","created","methods","file","loadParamsName","short_name","download","method","then","self","catch","console","finally","downloadAll","index","window","downloadSelected","loadYears"],"sourceRoot":"src/lib/modules/opse-year-based-download-block","sources":["opse-year-based-download-block.vue"],"sourcesContent":["<i18n  >\n{\n  \"en\": {\n    \"opseAccessData\": \"Data access\",\n    \"opseDownload\": \"Download\",\n    \"explicationText\": \"Select the years you want to download (all years are selected by default).\",\n    \"explicationTextParams\": \"Select the params you want to download (all params are selected by default).\",\n    \"year\": \"Year\",\n    \"param\": \"Parameter\",\n    \"downloadAll\": \"Download All years\",\n    \"downloadSelected\": \"Download selected years\",\n    \"opseAlert\":\"No data available yet.\"        \n\n  },\n  \"fr\": {\n    \"opseAccessData\": \"Accès aux données\",\n    \"opseDownload\": \"Téléchargement\",\n    \"explicationText\": \"Selectionnez les années que vous voulez télécharger (toutes les années sont sélectionées par défaut).\",\n    \"explicationTextParams\": \"Selectionnez les paramètres que vous voulez télécharger (tous les paramètres sont sélectionés par défaut).\",\n    \"year\": \"Année\",\n    \"param\": \"Parametre\",\n    \"downloadAll\": \"Télécharger\",\n    \"downloadSelected\": \"Télécharger la sélection\",\n    \"opseAlert\":\"Aucune donnée n'est encore disponible.\"\n    \n\n  }\n}\n</i18n>\n\n<template>\n  <div>\n    <v-card v-if=\"isVisible\" :style=\"applyTheme\" :flat=\"true\">\n      <v-card-title>\n        <v-icon large left style=\"color: #f39c12\">mdi-database</v-icon>\n        <span>{{ $t(\"opseAccessData\") }}</span>\n      </v-card-title>\n      <p>Select Data format</p>\n      <v-radio-group v-model=\"folderFile\" column>\n        <v-radio\n          label=\"Netcdf\"\n          value=\"/data/netcdf\"\n          @click=\"loadYears(folderFile)\"\n        ></v-radio>\n        <v-radio\n          label=\"CSV\"\n          value=\"/data/csv\"\n          @click=\"loadYears(folderFile)\"\n        ></v-radio>\n        <!--v-radio label=\"GEOJSON\" value=\"/data/geojson\" @click=\"loadYears(folderFile)\"></v-radio>\n              <v-radio label=\"SHAPE\" value=\"/data/shp\" @click=\"loadYears(folderFile)\"></v-radio-->\n      </v-radio-group>\n      <p>To download the data files, you should agree with the Data Policy.</p>\n      <!--p v-if=\"downloadAllowed\"> No data availaible</p-->\n      <v-alert v-if=\"downloadAllowed\" dense outlined type=\"error\">{{\n        $t(\"opseAlert\")\n      }}</v-alert>\n      <p>\n        <v-checkbox\n          v-model=\"dataPolicy\"\n          label=\"I agree with the Data Policy\"\n          hide-details\n          :disabled=\"downloadAllowed\"\n        ></v-checkbox>\n      </p>\n      <span class=\"explication\">{{ $t(\"explicationTextParams\") }}</span>\n      <article>\n        <v-btn-toggle\n          v-model=\"selectedParams\"\n          color=\"primary\"\n          group\n          multiple\n          class=\"d-flex align-center flex-row flex-wrap\"\n        >\n          <v-btn\n            v-for=\"(param, index) in params\"\n            :key=\"index\"\n            :value=\"param\"\n            text\n            :disabled=\"!dataPolicy\"\n          >\n            <section>\n              <div class=\"label-year font-weight-thin rounded-5\">\n                {{ $t(\"param\") }}\n              </div>\n              <div class=\"font-weight-black text-center d-flex align-center justify-space-around\">\n                <v-tooltip bottom>\n                 <template v-slot:activator=\"{ on, attrs }\">\n                <span v-bind=\"attrs\" v-on=\"on\"\n                      >\n                {{ param }}</span>\n                 </template>\n                 <span>{{ loadParamsName(param) }}</span>\n                </v-tooltip>\n              </div>\n              \n            </section>\n          </v-btn>\n        </v-btn-toggle>\n      </article>\n      <span class=\"explication\">{{ $t(\"explicationText\") }}</span>\n      <article>\n        <v-btn-toggle\n          v-model=\"selectedYears\"\n          color=\"primary\"\n          group\n          multiple\n          class=\"d-flex align-center flex-row flex-wrap\"\n        >\n          <v-btn\n            v-for=\"(year, index) in years\"\n            :key=\"index\"\n            :value=\"year\"\n            text\n            :disabled=\"!dataPolicy\"\n          >\n            <section>\n              <div class=\"label-year font-weight-thin rounded-5\">\n                {{ $t(\"year\") }}\n              </div>\n              <div class=\"font-weight-black\">\n                {{ year }}\n              </div>\n            </section>\n          </v-btn>\n        </v-btn-toggle>\n      </article>\n      <v-btn\n        color=\"warning\"\n        class=\"ma-4\"\n        @click=\"downloadAll(folderFile)\"\n        :disabled=\"!url || downloadAllowed || !dataPolicy\"\n        >{{ $t(\"downloadAll\") }}</v-btn\n      >\n      <v-btn\n        color=\"warning\"\n        class=\"ma-4\"\n        @click=\"downloadSelected(folderFile)\"\n        :disabled=\"!url || selectedYears.length == 0 || downloadAllowed\"\n        >{{ $t(\"downloadSelected\") }}</v-btn\n      >\n    </v-card>\n  </div>\n</template>\n\n<script>\nimport { applyPrimaryAndSecondaryColors } from \"../../utils\";\nexport default {\n  name: \"opse-year-based-download-block\",\n\n  data() {\n    return {\n      dataPolicy: false,\n      years: [],\n      params: [],\n      selectedYears: [],\n      selectedParams: [],\n      currentStatus: \"PREPARING_REQUEST\",\n      url: null,\n      folderFile: \"/data/netcdf\",\n    };\n  },\n\n  props: {\n    language: {\n      type: String,\n      default: \"en\",\n    },\n    theme: {\n      type: Object,\n      default: () => {\n        return {\n          primaryColor: \"#F39C12\",\n          secondaryColor: \"#AAA\",\n        };\n      },\n    },\n\n    metadata: {\n      type: Object,\n      default: () => {\n        return {};\n      },\n    },\n  },\n\n  computed: {\n    applyTheme() {\n      return applyPrimaryAndSecondaryColors(this.theme);\n    },\n\n    isVisible() {\n      let isVisible = false;\n      if (this.url != null) {\n        isVisible = true;\n      }\n\n      this.$emit(\"getVisibility\", {\n        name: this.$options.name,\n        programmaticScrollingTitle: this.$t(\"opseDownload\"),\n        isVisible,\n      });\n      return isVisible;\n    },\n\n    downloadAllowed() {\n      if (this.years && this.years.length > 0) {\n        return false;\n      }\n      return true;\n    },\n  },\n\n  watch: {\n    metadata() {\n      this.loadYears();\n    },\n    language(value) {\n      this.$i18n.locale = value;\n    },\n  },\n\n  created() {\n    this.$i18n.locale = this.language;\n    //this.loadYears()\n    this.file();\n  },\n\n  methods: {\n    file() {\n      this.loadYears(this.folderFile);\n    },\n\n    loadParamsName(short_name) {\n      if (this.metadata.parameterSet == null) return \"\";\n      for (let i = 0; i < this.metadata.parameterSet.length; i++) {\n        if (this.metadata.parameterSet[i].shortName == short_name) {\n          return this.metadata.parameterSet[i].longName;\n        }\n      }\n      return \"\";\n    },\n\n    download(url) {\n      this.currentStatus = \"PREPARING_REQUEST\";\n      let self = this;\n      this.downloadDialog = true;\n      this.axios({\n        method: \"get\",\n        url: url,\n      })\n        .then((response) => {\n          self.requestId = response.data;\n          /*self.checker = setInterval(() => {\n            self.checkDownload(self.metadata.id,self.requestId);\n           }, 5000);*/\n        })\n        .catch((error) => {\n          // debugger\n          //self.clearChecker();\n          self.displayError(\"An error has occured:\" + error);\n          console.log(error);\n        })\n        .finally(() => {\n          this.loading = false;\n        });\n    },\n\n    downloadAll(index) {\n      //this.download(this.url+\"download?collectionId=\"+this.metadata.id)\n      window.open(\n        this.url +\n          \"data/v1_0/download?collectionId=\" +\n          this.metadata.id +\n          \"&folder=\" +\n          index\n      );\n    },\n\n    downloadSelected(index) {\n      window.open(\n        this.url +\n          \"data/v1_0/downloadYear?collectionId=\" +\n          this.metadata.id +\n          \"&folder=\" +\n          index +\n          \"&filter=year___\" +\n          this.selectedYears.join(\"___\") +\n          \"____parameter___\" +\n          this.selectedParams.join(\"___\")\n      );\n    },\n\n    loadYears(index) {\n      let url = null;\n      if (\n        this.metadata &&\n        this.metadata.links &&\n        this.metadata.links.length > 0\n      ) {\n        for (let i = 0; i < this.metadata.links.length; i++) {\n          if (this.metadata.links[i].type == \"OPENSEARCH_LINK\") {\n            url = this.metadata.links[i].url;\n            break;\n          }\n        }\n      }\n      this.url = url;\n      if (url == null) {\n        return;\n      }\n\n      this.loading = true;\n      console.log(\n        \"url \",\n        this.url +\n          \"data/v1_0/request1?collection=\" +\n          this.metadata.id +\n          \"&folder=\" +\n          index\n      );\n      this.axios({\n        method: \"get\",\n        url:\n          this.url +\n          \"data/v1_0/request1?collection=\" +\n          this.metadata.id +\n          \"&folder=\" +\n          index,\n        //url: this.url + \"/request?collection=\"+this.metadata.id,\n      })\n        .then((response) => {\n          this.years = [];\n          this.params = [];\n          this.selectedParams = [];\n          console.log(\"Response\", response.data);\n\n          for (let i = 0; i < response.data.entries.length; i++) {\n            this.years.push(response.data.entries[i].date.substring(0, 4));\n          }\n          for (let i = 0; i < response.data.pivots.length; i++) {\n            this.selectedParams.push(response.data.pivots[i].name);\n          }\n          for (let i = 0; i < response.data.parameters.length; i++) {\n            if (\n              !this.selectedParams.includes(response.data.parameters[i].name)\n            ) {\n              this.params.push(response.data.parameters[i].name);\n            }\n          }\n        })\n        .catch((error) => {\n          // this.displayError(\"An error has occured:\" + error)\n          console.log(error);\n        })\n        .finally(() => {\n          this.loading = false;\n        });\n    },\n  },\n};\n</script>\n"]}]}